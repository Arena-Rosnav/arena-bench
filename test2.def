Bootstrap: localimage
From: arena.sif

%post
    cd $ARENA_ROOT/arena_ws/src/arena/arena-rosnav

    $ARENA_ROOT/.local/bin/poetry lock --no-update \
    && $ARENA_ROOT/.local/bin/poetry install --no-interaction --no-ansi --no-root --with training,social

    # Install rosdeps
    cd $ARENA_ROOT/arena_ws
    rosdep install --from-paths src --ignore-src -r -y

    # Build workspace
    . /opt/ros/$ROS_DISTRO/setup.sh
    catkin_make

    # Source workspace
    . $ARENA_ROOT/$ARENA_WS/devel/setup.sh

    # Setup Xvfb
    apt-get install -y x11-apps
    export DISPLAY=99
    Xvfb :99 -screen 0 1024x768x16 &
    exec "$@"

    alias poetry=$ARENA_ROOT/.local/bin/poetry

    